<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beyond the Case - Shop</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body { display: flex; flex-direction: column; min-height: 100vh; }

    /* Sidebar */
    .navbar {
      width: 220px;
      background-color: #2c3e50;
      color: white;
      padding: 20px 0;
      position: fixed;
      height: 100vh;
    }
    .navbar h2 { margin-bottom: 30px; text-align: center; }
    .navbar button {
      display: block;
      width: 100%;
      background-color: #34495e;
      color: white;
      border: none;
      padding: 16px 20px;
      text-align: left;
      cursor: pointer;
      font-size: 16px;
    }
    .navbar button:hover { background-color: #3d5a73; }
    .dropdown { display: none; flex-direction: column; }
    .has-dropdown:hover .dropdown { display: flex; }
    .dropdown a {
      color: white;
      padding: 12px 30px;
      text-decoration: none;
      font-size: 14px;
    }
    .dropdown a:hover { background-color: #3d5a73; }

    /* Main */
    .main { margin-left: 220px; flex: 1; display: flex; flex-direction: column; }

    /* Topbar */
    .topbar {
      height: 60px;
      background-color: #ecf0f1;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 0 20px;
      gap: 20px;
    }
    .dropdown-hover, .dropdown-click { position: relative; display: inline-block; }
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      z-index: 10;
      min-width: 150px;
    }
    .dropdown-hover:hover .dropdown-menu,
    .dropdown-click:hover .dropdown-menu { display: flex; }
    .dropdown-menu button {
      padding: 10px;
      background-color: white;
      border: none;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
    }
    .dropdown-menu button:hover { background-color: #f0f0f0; color: #3498db; }
    .dropdown-hover button, .dropdown-click button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
    }

    /* Content */
    .content { padding: 20px; flex-grow: 1; }
    .section { margin-bottom: 20px; }
    .section h2 { margin-bottom: 10px; text-align: center; }
    .products {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .product {
      width: 150px;
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      background-color: white;
      font-size: 14px;
    }
    .product img { width: 100%; height: auto; margin-bottom: 6px; }

    /* Footer */
    .footer {
      margin-top: auto;
      background-color: #333;
      padding: 8px 20px;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 60px;
      flex-wrap: wrap;
      font-size: 14px;
      border-top: 2px solid #444;
    }
    .footer-column { min-width: 150px; display: flex; flex-direction: column; align-items: center; }
    .footer-column h4 { margin-bottom: 10px; font-size: 16px; color: #ffffff; }
    .footer-column a { text-decoration: none; color: #cccccc; margin-bottom: 6px; }
    .footer-column a:hover { color: #ffffff; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="navbar">
    <h2>Beyond the Case</h2>
    <button onclick="window.location.href='index.html'">Home</button>
    <button onclick="window.location.href='shop.html'">Shop</button>
    <button>Promotions</button>
    <div class="has-dropdown">
      <button>User Section â–¾</button>
      <div class="dropdown">
        <a>My Orders</a>
        <a>Track Order</a>
        <a>My Wishlist</a>
      </div>
    </div>
    <div class="has-dropdown">
      <button>Help & Info â–¾</button>
      <div class="dropdown">
        <a>Help Center</a>
        <a>Contact Us</a>
        <a>Shipping Info</a>
        <a>Return Policy</a>
        <a>About Us</a>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Topbar -->
    <div class="topbar">
      <div class="dropdown-hover">
        <button>Intercom â–¾</button>
        <div class="dropdown-menu">
          <button>Product Tour</button>
          <button>Tour 1</button>
          <button>Tour 2</button>
        </div>
      </div>
      <div class="dropdown-click">
        <button>Profile â–¾</button>
        <div class="dropdown-menu">
          <button onclick="location.href='profile.html'">Profile</button>
          <button>Orders</button>
          <button>Wishlist</button>
          <button onclick="logout()">Logout</button>
        </div>
      </div>
      <span>ðŸ›’ Cart</span>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="section">
        <h2>Best Sellers</h2>
        <div class="products">
          <div class="product"><img src="img/test.jpg" alt="iPhone 15 Pro"> iPhone 15 Pro</div>
          <div class="product"><img src="img/test.jpg" alt="MagSafe Charger"> MagSafe Charger</div>
          <div class="product"><img src="img/test.jpg" alt="AirPods Pro"> AirPods Pro</div>
          <div class="product"><img src="img/test.jpg" alt="Samsung Galaxy S24"> Samsung Galaxy S24</div>
          <div class="product"><img src="img/test.jpg" alt="Wireless Power Bank"> Wireless Power Bank</div>
          <div class="product"><img src="img/test.jpg" alt="Apple Watch Series 9"> Apple Watch Series 9</div>
        </div>
      </div>

      <div class="section">
        <h2>New Arrivals</h2>
        <div class="products">
          <div class="product"><img src="img/test.jpg" alt="Pixel 8 Pro"> Pixel 8 Pro</div>
          <div class="product"><img src="img/test.jpg" alt="MagSafe Leather Case"> MagSafe Leather Case</div>
          <div class="product"><img src="img/test.jpg" alt="USB-C Fast Charger"> USB-C Fast Charger</div>
          <div class="product"><img src="img/test.jpg" alt="Galaxy Buds 2 Pro"> Galaxy Buds 2 Pro</div>
          <div class="product"><img src="img/test.jpg" alt="iPad Pro 12.9"> iPad Pro 12.9</div>
          <div class="product"><img src="img/test.jpg" alt="Phone Ring Holder"> Phone Ring Holder</div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer-column">
        <h4>Customer Service</h4>
        <a>Help Center</a>
        <a>Returns</a>
        <a>Shipping</a>
      </div>
      <div class="footer-column">
        <h4>About</h4>
        <a>Our Story</a>
        <a>Careers</a>
        <a>Privacy Policy</a>
      </div>
      <div class="footer-column">
        <h4>Follow Us</h4>
        <a>Facebook</a>
        <a>Instagram</a>
        <a>Twitter</a>
      </div>
    </div>
  </div>

  <script>
  function logout() {
    localStorage.clear();     // clear saved login/session data
    window.location.href = "index.html"; // redirect back to home
  }
</script>

<!-- Intercom Messenger Embed -->
<script>
  window.intercomSettings = {
    app_id: "lu3dtr42"
  };

  const isUserLoggedIn = localStorage.getItem("isLoggedIn") === "true";

  if (isUserLoggedIn) {
    const dateLastActiveStr = localStorage.getItem("dateLastActive");
    const today = new Date();

    let daysInactive = "N/A";
    let memTier = "N/A";
    let activityStatus = "ACTIVE";
    let age = "N/A";

    // calculate age from DOB
    const dobStr = localStorage.getItem("dateOfBirth");
    if (dobStr) {
      const dob = new Date(dobStr);
      age = today.getFullYear() - dob.getFullYear();
      const m = today.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
        age--;
      }
    }

    // calculate inactivity and membership tier
    if (dateLastActiveStr) {
      const lastActive = new Date(dateLastActiveStr);
      const diffTime = today.getTime() - lastActive.getTime();
      daysInactive = Math.floor(diffTime / (1000 * 60 * 60 * 24));

      if (daysInactive >= 1 && daysInactive <= 30) {
        memTier = "P1M";
      } else if (daysInactive >= 31 && daysInactive <= 90) {
        memTier = "P3M";
      } else if (daysInactive >= 91 && daysInactive <= 180) {
        memTier = "P6M";
      } else if (daysInactive >= 181 && daysInactive <= 360) {
        memTier = "P12M";
      } else if (daysInactive >= 361) {
        memTier = "P12MI";
      }

      if (daysInactive >= 91) {
        activityStatus = "INACTIVE";
      } else {
        activityStatus = "ACTIVE";
      }
    }

    // Pass user info & attributes to Intercom
    window.intercomSettings = {
      app_id: "lu3dtr42",
      user_id: localStorage.getItem("userId") || undefined,
      name: localStorage.getItem("userName") || undefined,
      email: localStorage.getItem("userEmail") || undefined,
      created_at: Math.floor(new Date(localStorage.getItem("dateRegistered") || Date.now()).getTime() / 1000),

      credit: localStorage.getItem("currentCredit") || "0",
      lastactivity: localStorage.getItem("dateLastActive") || "N/A",
      birthday: localStorage.getItem("dateOfBirth") || "N/A",
      registerdate: localStorage.getItem("dateRegistered") || "N/A",
      dateMembershipStarted: localStorage.getItem("dateWhenMembershipStarted") || "N/A",
      genderr: localStorage.getItem("gender") || "N/A",
      memStatus: localStorage.getItem("membershipStatus") || "N/A",
      number: localStorage.getItem("mobileNumber") || "N/A",
      race: localStorage.getItem("raceRecode") || "N/A",

      daysInactive: daysInactive,
      memTier: memTier,
      ActivityStatus: activityStatus,
      age: age
    };
  }

  // Load Intercom widget
  (function() {
    var w = window; var ic = w.Intercom;
    if (typeof ic === "function") {
      ic('reattach_activator'); ic('update', w.intercomSettings);
    } else {
      var d = document; var i = function() { i.c(arguments) }; i.q = []; i.c = function(args) { i.q.push(args) };
      w.Intercom = i; function l() {
        var s = d.createElement('script'); s.type = 'text/javascript'; s.async = true;
        s.src = 'https://widget.intercom.io/widget/lu3dtr42';
        var x = d.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);
      }
      if (document.readyState === 'complete') { l(); }
      else if (w.attachEvent) { w.attachEvent('onload', l); }
      else { w.addEventListener('load', l, false); }
    }
  })();
</script>

</body>
</html>